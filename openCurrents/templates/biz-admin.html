{% extends 'redemption-list.html' %}

{% load staticfiles %}
{% load macros %}

{% block main %}
<!DOCTYPE html>
<html>
  <head>
    {% include "partials/head.html" %}
  </head>

  <body>
    {% include "partials/header.html" %}

    <div id="container" class="js-close-any" canvas="container">
      <div id="wrapper">
        {% if status_msg %}
        <div class="success row half-margin-top">
          {{status_msg}}
        </div>
        {% endif %}

        <div class="row">
          <div id="status_msg" class="success one-margin-top small-10 small-centered medium-8 columns">
          </div>
        </div>

        <div class="hide-for-small-only row full-width collapse one-margin-top no-margin-bottom">
          <div class="left medium-6 medium-offset-1 columns">
            <!-- <img id="profile-img" src="{% static 'img/smiley.jpg' %}" class="fit-left round" />
            <span class="input-sizer"> -->
              <h5 class="one-margin-top no-margin-bottom trim-text"> {{ orgname }} </h5>
              <h6>{{ user.first_name }} {{ user.last_name }}</h6>
            <!-- </span> -->
          </div>

          <div class="right one-margin-top medium-4 columns end">
            <span class="no-wrap">
              <h6 class="no-margin-bottom inline">Currents available:</h6>
              <img class="h6-symbol" src="{% static 'img/symbol.svg' %}"/>
              <h6 class="inline">
                {{ currents_balance }}
              </h6>
            </span>

            <div class="no-margin-bottom">
              <span class="no-wrap">
                <h6 class="half-margin-bottom inline">Pending:</h6>
                <img class="h6-symbol" src="{% static 'img/symbol.svg' %}"/>
                <h6 class="inline">
                  {{ currents_pending }}
                </h6>
              </span>
            </div>
          </div>
        </div>

        <div class="show-for-small-only row one-margin-top">
          <div class="columns">
            <!-- <img id="profile-img" src="{% static 'img/smiley.jpg' %}" class="round" /> -->
            <h4 class="half-margin-top no-margin-bottom"> {{ orgname }} </h4>
            <h5>{{ user.first_name }} {{ user.last_name }}</h5>

            <div class="one-margin-top half-margin-bottom">
              <span class="no-wrap">
                <h6 class="no-margin-bottom inline">Currents available:</h6>
                <img class="h6-symbol" src="{% static 'img/symbol.svg' %}"/>
                <h6 class="inline">
                  {{ currents_balance }}
                </h6>
              </span>

              <div class="no-margin-bottom">
                <span class="no-wrap">
                  <h6 class="half-margin-bottom inline-block">Pending:</h6>
                  <img class="h6-symbol" src="{% static 'img/symbol.svg' %}"/>
                  <h6 class="inline">
                    {{ currents_pending }}
                  </h6>
                </span>
              </div>
            </div>
          </div>
        </div>

        <p class="no-margin-bottom">
          <a href="{% url 'openCurrents:offer' %}" class="no-margin-bottom button round small">
            Post an offer
          </a>
        </p>

        <div class="left row one-margin-top full-width collapse">
          <div class="small-11 medium-10 small-centered columns">
            <h6 class="half-margin-bottom">Our offers</h6>

            {% if offers %}

              {% for offer in offers %}
                <div class="row half-margin-top">
                  <div class="left small-9 columns">
                    <!-- <p>Fast Folks Bike Shop & Cafe accepts Currents for <strong>50% of flat fixes</strong> <span class="small-text grey">Limit 50 transactions per month</span></p> -->
                    <p>
                      {{ orgname }} accepts Currents for

                      <strong>
                        {{offer.currents_share}}% of {{offer.item.name}}
                      </strong>

                      {% if offer.limit != -1 %}
                        <span class="small-text grey">
                          Limit {{ offer.limit }} transactions per month
                        </span>
                      {% endif %}
                    </p>
                  </div>

                  <div class="right relative small-3 columns">
                    <a class="mini-open">
                      <i class="blue half-margin-right fa-chevron-circle-down fa fa-lg"></i>
                    </a>
                    <ul class="mini-menu">
                      <a href="{% url 'openCurrents:edit-offer' offer.id %}">
                        <li> Edit offer </li>
                      </a>
                      <a class="delete-offer-popup_open">
                        <li class="alert"> Delete offer </li>
                      </a>
                    </ul>
                  </div>
                </div>
              {% endfor %}

            {% else %}
                <div class="row">
                  <div class="left small-12 columns">
                    <p>{{ orgname }} has not made any offers. <a href="{% url 'openCurrents:offer' %}">Create one!</a></p>
                  </div>
                </div>

            {% endif %}
          </div>
        </div>

        {% macro redemption_list_macro arg_list arg_status arg_timezone %}
          {% block redemption_list %}
            {% with redemptions=arg_list redemption_status=arg_status timezone=arg_timezone %}
              {{ block.super }}
            {% endwith %}
          {% endblock %}
        {% endmacro %}

        {% usemacro redemption_list_macro redeemed_pending 'Pending' org_timezone %}

        {% usemacro redemption_list_macro redeemed_approved 'Approved' org_timezone %}

        <!-- community feed code. Hardcoded not dynamic -->
        <!-- <div class="row one-margin-top">
          <div class="left medium-8 small-centered columns">
            <h6 class="center half-margin-bottom">Community activity</h6>
            <div id="community-feed">
              <div class="feed-item">
                <strong>Jacob Jacobs</strong> joined openCurrents!
              </div>

              <div class="feed-item">
                <strong>Keep Austin Beautiful</strong> created a project: <strong><a>Let's clean up Lady Bird Lake<span class="no-wrap">!<i class="half-margin-left fa fa-arrow-circle-right"></i></span></a></strong>
              </div>

              <div class="feed-item">
                <strong>Jacob Jacobs</strong> will be helping <strong>Keep Austin Beautiful</strong> clean up Lady Bird Lake!
              </div>

              <div class="feed-item">
                <strong>Keep Austin Beautiful</strong> issued 2 Currents to <strong>Jacob Jacobs</strong>.
              </div>
            </div>
          </div>
        </div -->

            <!-- <h5 class="fit-left">I care about</h5>
            <span class="input-sizer"><input name="offer-text" type="text" class="profile-text" value="showing people their power"/></span>

            <div class="tag-block">
              <button class="button round tiny">Nature</button>
            </div>

            <h5 class="fit-left">I offer</h5>
            <span class="input-sizer"><input name="offer-text" type="text" class="profile-text" /></span>

            <h5 class="fit-left">I am looking for</h5>
            <span class="input-sizer"><input name="offer-text" type="text" class="profile-text" /></span> -->

            <!--<h5 class="one-margin-top one-margin-bottom">My badges</h5>

            <h5 class="one-margin-top one-margin-bottom">My hours given</h5>
            -->

        <div id="push"></div>

      <!-- wrapper div-->
      </div>

      {% include 'partials/footer.html' %}

    <!--container div -->
    </div>

    <div id="bottom-stripe" class="full-width"></div>

    <div off-canvas="menu right shift" id="menu">
      {% include 'partials/menu.html' %}
    </div>

    <div id="delete-offer-popup" class="modal center small-12 medium-9 large-7 small-centered columns">
      <div class="row center">
        <h3 class="popup-title">Are you sure?</h3>
        <button type="submit" class="button round alert">Yes - Delete offer</button>
        <a class="delete-offer-popup_close button round secondary">Cancel</a>
      </div>
    </div>

    <div id="view-receipt-popup" class="modal center small-12 medium-9 large-7 small-centered columns">
      <div class="row center">
        <div class="small-12 medium-8 small-centered columns">
          <h4 class="popup-title">View proof of purchase</h4>
        </div>
      </div>

      <div class="row collapse">
        <div class="small-12 medium-8 small-centered columns">
          <img src="{% static 'img/first_receipt.jpeg' %}" />
        </div>
      </div>

      <div class="row center three-halves-margin-top">
        <a class="view-receipt-popup_close button round">Close</a>
        <a href="javascript:void(Tawk_API.toggle())" class="button round secondary">Contact us</a>
      </div>

    </div>


    <script type="text/javascript">
      $(document).ready(function(){
        $('#view-receipt-popup, #delete-offer-popup').popup({
          vertical: 'top',
          transition: 'all 0.75s',
          scrolllock: true,
        });

        $('.mini-open').click(function(){
          $('.mini-menu').hide();
          $(this).siblings('.mini-menu').toggle();
          $(this).attr('visibility', 'visible');
        });

        $(document).click(function(e) {
          var target = e.target;
          if (!$(target).is('.mini-open') && !$(target).parents().is('.mini-open')) {
            $('.mini-menu').hide();
          }
        });
      });
      function status(){
        $('#status_msg').html("There are no hours that need your approval.");
      }
    </script>

    <script type="text/javascript" src="{% static "js/end_scripts.js" %}"></script>
  </body>
</html>
{% endblock main %}
