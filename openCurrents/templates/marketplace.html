{% extends "layouts/base.html" %}

{% load staticfiles %}
{% load tags %}

{% block heading %}
  <div class="row two-margin-top three-halves-margin-bottom">
    <div class="left small-6 medium-6 medium-offset-1 columns">
      <h5 class="half-margin-top">
        {% block name %}
          Marketplace
        {% endblock name %}
      </h5>
    </div>

    <div class="right small-6 medium-4 columns end">
      <select class="" name="biz-type">
        <option value="featured">Featured</option>
        <option value="all">All</option>
        <option value="clothing">Clothing</option>
        <option value="food">Food & drink</option>
        <option value="health">Health & wellness</option>
        <option value="misc">Miscellaneous</option>
      </select>
    </div>
  </div>
{% endblock heading %}

{% block content %}
  <div class="row">
    <div class="small-12 medium-10 small-centered columns">
      {% include "partials/featured-bizzes.html" %}
    </div>
  </div>

  <div class="row one-margin-bottom center">
    <div class="small-12 medium-10 small-centered columns">
      <div class="row">
        {% if offers %}
          <!-- this should become 'for businesses of selected biz-type with active offers,
          show biz logo' (once per biz). -->
          {% for offer in offers %}
            {% with num_remaining=offer.limit|less:offer.num_redeemed %}
              <div class="one-margin-top small-6 medium-3 columns">
                <a href="{% url 'openCurrents:biz-profile' %}">
                  <img class="biz-logos" src="{% static 'img/whole-foods.png' %}"/>
                </a>
              </div>
            {% endwith %}
          {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>

  {% if request.user.is_authenticated %}
    <div class="row">
      <a href="{% url 'openCurrents:profile' %}"
      class="one-margin-top button round tiny secondary">
        Back to profile
      </a>
    </div>
  {% endif %}
{% endblock content %}


{% block popups %}
  <div id="transactions-popup" class="modal center small-12 medium-9 large-7 small-centered columns">
    <div class="row center">
      <h3 class="popup-title">How transactions work</h3>
    </div>

    <div class="row center">
      <div class="small-centered medium-10 columns">

        <p>To make it as easy as possible for businesses to accept Currents,
          nothing changes at point of sale - simply pay full price and ask for
          your receipt.</p>

        <p>Upload a picture of your receipt, and we will exchange your Currents
          for the business' dollars once they verify transactions at the end of
          the month.</p>

        <div class="one-margin-bottom">
          <input type="checkbox" name="no-more-popup" id="no-more-popup" class="custom-checkbox">
            <!-- <label for="no-more-popup">Don't show this again</label> -->
        </div>
        <button class="transactions-popup_close button round">Got it</button>
      </div>
    </div>
  </div>
{% endblock popups %}


{% block js %}
  <script type="text/javascript">
    $(document).ready(function(){
      $('#transactions-popup').popup({
        vertical: 'top',
        transition: 'all 0.75s',
        scrolllock: true,
        // autoopen: true,
      });

      $('.show-biz-deets').click(function(){
        $(this).parents('.row').next('.biz-deets').slideToggle();
        $(this).find('span').text(function(i, text){
          return text === "Show" ? "Hide" : "Show";
        })
      });
    });
  </script>

  {% include "scripts/mini-menu.html" %}

{% endblock js %}
